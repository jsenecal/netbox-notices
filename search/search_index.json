{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":""},{"location":"#netbox-notices","title":"NetBox Notices","text":"<p>Repository: github.com/jsenecal/netbox-notices Documentation: jsenecal.github.io/netbox-notices PyPI: pypi.org/project/netbox-notices </p> <p>Original Project: Forked and inspired from jasonyates/netbox-circuitmaintenance, differs in the ability to track more than just maintenances, and circuits.</p> <p>A NetBox plugin built to track maintenance and outage events across various NetBox models. This plugin is agnostic in that it is only built to store data surrounding maintenance/outage events and provide an overview of historical, active and upcoming events. The plugin tracks events at the provider level and associates impact across multiple NetBox object types (circuits, devices, virtual machines, power feeds, sites, etc.).</p> <p>The plugin does not directly provide an automated approach to ingesting provider notifications, instead it extends NetBox's extensive REST API and provides GET/POST/PUT/PATCH methods to manage events. The plugin is intended to be coupled with an automated parser to handle the parsing of provider notifications and the delivery of the events to the plugin's REST API. Several example parsers are documented here.</p> <p>Important Note: This is a significant refactoring from the original <code>netbox-circuitmaintenance</code> plugin. There is no upgrade path from the original plugin. If you are using the original plugin, you will need to migrate your data manually.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Track provider maintenance events</li> <li>Track impact from provider maintenance across multiple NetBox object types</li> <li>Configurable allowed object types (circuits, devices, virtual machines, power feeds, sites, etc.)</li> <li>Provides a consolidated view of active, upcoming and historical maintenance events at the provider and object level</li> <li>Track unplanned outage events with optional end times and ETR tracking</li> <li>Unified event notification tracking</li> <li>Quick action buttons for common maintenance operations:</li> <li>Acknowledge maintenance events</li> <li>Reschedule maintenance (only before start time)</li> <li>Mark maintenance as in-progress or completed</li> <li>Cancel maintenance with confirmation</li> <li>Event timeline with status-specific icons and colors</li> <li>Maintenance rescheduling with automatic status updates</li> <li>Interactive calendar view with FullCalendar</li> <li>iCalendar feed for external calendar integration (Google Calendar, Outlook, Apple Calendar)</li> <li>Maintenance overlap detection (coming soon)</li> </ul>"},{"location":"#compatibility","title":"Compatibility","text":"<p>This plugin requires NetBox 4.5.0 or higher.</p> NetBox Version Plugin Version 4.5.x 1.x"},{"location":"#installing","title":"Installing","text":"<p>A working installation of Netbox 4.5.2+ is required - see official documentation.</p>"},{"location":"#package-installation","title":"Package Installation","text":"<p>Activate your virtual env and install via pip:</p> <pre><code>$ source /opt/netbox/venv/bin/activate\n(venv) $ pip install netbox-notices\n</code></pre> <p>To ensure the plugin is automatically re-installed during future upgrades, add the package to your <code>local_requirements.txt</code>:</p> <pre><code># echo netbox-notices &gt;&gt; local_requirements.txt\n</code></pre>"},{"location":"#enable-the-plugin","title":"Enable the Plugin","text":"<p>In the Netbox <code>configuration.py</code> configuration file add or update the PLUGINS parameter, adding <code>vendor_notification</code>:</p> <pre><code>PLUGINS = [\n    'notices'\n]\n\nPLUGINS_CONFIG = {\n    \"notices\": {},\n}\n</code></pre>"},{"location":"#configuration","title":"Configuration","text":"<p>The plugin supports configuration of which NetBox object types can be linked to maintenance and outage events. By default, the plugin allows linking to circuits, power feeds, and sites.</p>"},{"location":"#default-configuration","title":"Default Configuration","text":"<p>If you don't specify any configuration, the plugin uses these defaults:</p> <pre><code>PLUGINS_CONFIG = {\n    \"notices\": {\n        \"allowed_content_types\": [\n            \"circuits.Circuit\",\n            \"dcim.PowerFeed\",\n            \"dcim.Site\",\n        ]\n    }\n}\n</code></pre>"},{"location":"#custom-configuration","title":"Custom Configuration","text":"<p>You can customize which object types are allowed by specifying the <code>allowed_content_types</code> setting. Content types are specified in the format <code>app_label.model_name</code>.</p>"},{"location":"#example-add-devices-and-virtual-machines","title":"Example: Add Devices and Virtual Machines","text":"<pre><code>PLUGINS_CONFIG = {\n    \"notices\": {\n        \"allowed_content_types\": [\n            \"circuits.Circuit\",\n            \"dcim.Device\",\n            \"dcim.PowerFeed\",\n            \"dcim.Site\",\n            \"virtualization.VirtualMachine\",\n        ]\n    }\n}\n</code></pre>"},{"location":"#example-minimal-configuration-circuits-only","title":"Example: Minimal Configuration (Circuits Only)","text":"<pre><code>PLUGINS_CONFIG = {\n    \"notices\": {\n        \"allowed_content_types\": [\n            \"circuits.Circuit\",\n        ]\n    }\n}\n</code></pre>"},{"location":"#example-extended-configuration","title":"Example: Extended Configuration","text":"<pre><code>PLUGINS_CONFIG = {\n    \"notices\": {\n        \"allowed_content_types\": [\n            \"circuits.Circuit\",\n            \"dcim.Device\",\n            \"dcim.Interface\",\n            \"dcim.PowerFeed\",\n            \"dcim.Rack\",\n            \"dcim.Site\",\n            \"ipam.IPAddress\",\n            \"ipam.Prefix\",\n            \"virtualization.VirtualMachine\",\n            \"virtualization.VMInterface\",\n        ]\n    }\n}\n</code></pre>"},{"location":"#how-configuration-affects-behavior","title":"How Configuration Affects Behavior","text":"<ul> <li>Only object types listed in <code>allowed_content_types</code> will appear in the Impact creation forms</li> <li>The API will reject attempts to create impacts for non-allowed object types</li> <li>Changing the configuration requires a NetBox restart</li> <li>This setting controls which objects can be linked via the <code>Impact</code> model to maintenance and outage events</li> </ul>"},{"location":"#common-netbox-object-types","title":"Common NetBox Object Types","text":"Content Type Description <code>circuits.Circuit</code> Network circuits <code>circuits.Provider</code> Service providers <code>dcim.Device</code> Physical network devices <code>dcim.Interface</code> Device network interfaces <code>dcim.PowerFeed</code> Power supply connections <code>dcim.PowerPanel</code> Power distribution panels <code>dcim.Rack</code> Equipment racks <code>dcim.Site</code> Physical locations <code>ipam.IPAddress</code> IP addresses <code>ipam.Prefix</code> IP prefixes/subnets <code>virtualization.VirtualMachine</code> Virtual machines <code>virtualization.VMInterface</code> VM network interfaces"},{"location":"#apply-database-migrations","title":"Apply Database Migrations","text":"<p>Apply database migrations with Netbox <code>manage.py</code>:</p> <pre><code>(venv) $ python manage.py migrate\n</code></pre>"},{"location":"#restart-netbox","title":"Restart Netbox","text":"<p>Restart the Netbox service to apply changes:</p> <pre><code>sudo systemctl restart netbox\n</code></pre>"},{"location":"#outage-tracking","title":"Outage Tracking","text":"<p>In addition to planned maintenance, this plugin supports tracking unplanned outage events:</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Optional End Time: Outages can be created without an end time, which becomes required when marking as resolved</li> <li>ETR Tracking: Track Estimated Time to Repair with full revision history via NetBox's changelog</li> <li>Outage Status Workflow:</li> <li>REPORTED: Initial state when outage is reported</li> <li>INVESTIGATING: Team is investigating root cause</li> <li>IDENTIFIED: Root cause identified, working on fix</li> <li>MONITORING: Fix applied, monitoring for stability</li> <li>RESOLVED: Outage fully resolved (requires end time)</li> <li>Shared Impact Model: Uses the same impact tracking as maintenance events (Impact model)</li> <li>Unified View: View both maintenance and outages together in a single interface</li> <li>Flexible Object Support: Link outages to any configured NetBox object type</li> </ul>"},{"location":"#calendar--ical-integration","title":"Calendar &amp; iCal Integration","text":"<p>The plugin provides an interactive calendar view and iCal feed for integrating maintenance events with external calendar applications.</p>"},{"location":"#calendar-view","title":"Calendar View","text":"<p>Access the calendar at Plugins \u2192 Notices \u2192 Calendar. Features include:</p> <ul> <li>Interactive FullCalendar: Month, week, and day views</li> <li>Color-coded events: Different colors for maintenance vs outage, and by status</li> <li>Click-to-view: Click any event to see details and navigate to full view</li> <li>Drag navigation: Navigate between time periods</li> </ul>"},{"location":"#ical-feed","title":"iCal Feed","text":"<p>Subscribe to maintenance events in your preferred calendar application:</p> <p>Subscription URL: <pre><code>https://your-netbox/api/plugins/notices/ical/?token=YOUR_API_TOKEN\n</code></pre></p> <p>Supported Calendar Apps: - Google Calendar: Settings \u2192 Add calendar \u2192 From URL - Outlook: Calendar \u2192 Add calendar \u2192 Subscribe from web - Apple Calendar: File \u2192 New Calendar Subscription</p> <p>Query Parameters: - <code>token</code>: Your NetBox API token (required) - <code>provider</code>: Filter by provider ID - <code>status</code>: Filter by status (e.g., <code>CONFIRMED</code>, <code>IN-PROCESS</code>) - <code>days_past</code>: Include events from N days ago (default: 30) - <code>days_future</code>: Include events up to N days ahead (default: 90)</p> <p>Example filtered subscription: <pre><code>/api/plugins/notices/ical/?token=YOUR_TOKEN&amp;provider=1&amp;status=CONFIRMED\n</code></pre></p>"},{"location":"#api-endpoints","title":"API Endpoints","text":"<p>Maintenance Events:</p> <pre><code>GET    /api/plugins/notices/maintenance/\nPOST   /api/plugins/notices/maintenance/\nGET    /api/plugins/notices/maintenance/{id}/\nPATCH  /api/plugins/notices/maintenance/{id}/\nDELETE /api/plugins/notices/maintenance/{id}/\n</code></pre> <p>Outage Events:</p> <pre><code>GET    /api/plugins/notices/outage/\nPOST   /api/plugins/notices/outage/\nGET    /api/plugins/notices/outage/{id}/\nPATCH  /api/plugins/notices/outage/{id}/\nDELETE /api/plugins/notices/outage/{id}/\n</code></pre> <p>Impact Tracking:</p> <pre><code>GET    /api/plugins/notices/impact/\nPOST   /api/plugins/notices/impact/\nGET    /api/plugins/notices/impact/{id}/\nPATCH  /api/plugins/notices/impact/{id}/\nDELETE /api/plugins/notices/impact/{id}/\n</code></pre> <p>Event Notifications (Received):</p> <pre><code>GET    /api/plugins/notices/eventnotification/\nPOST   /api/plugins/notices/eventnotification/\nGET    /api/plugins/notices/eventnotification/{id}/\nDELETE /api/plugins/notices/eventnotification/{id}/\n</code></pre> <p>Notification Templates:</p> <pre><code>GET    /api/plugins/notices/notification-templates/\nPOST   /api/plugins/notices/notification-templates/\nGET    /api/plugins/notices/notification-templates/{id}/\nPATCH  /api/plugins/notices/notification-templates/{id}/\nDELETE /api/plugins/notices/notification-templates/{id}/\n</code></pre> <p>Prepared Notifications:</p> <pre><code>GET    /api/plugins/notices/prepared-notifications/\nPOST   /api/plugins/notices/prepared-notifications/\nGET    /api/plugins/notices/prepared-notifications/{id}/\nPATCH  /api/plugins/notices/prepared-notifications/{id}/\nDELETE /api/plugins/notices/prepared-notifications/{id}/\n</code></pre> <p>Sent Notifications (read-only):</p> <pre><code>GET    /api/plugins/notices/sent-notifications/\nGET    /api/plugins/notices/sent-notifications/{id}/\n</code></pre>"},{"location":"#example-creating-an-outage","title":"Example: Creating an Outage","text":"<pre><code>POST /api/plugins/notices/outage/\n{\n    \"name\": \"OUT-2024-001\",\n    \"summary\": \"Fiber cut on Main Street\",\n    \"provider\": 1,\n    \"start\": \"2024-10-29T14:30:00Z\",\n    \"estimated_time_to_repair\": \"2024-10-29T18:00:00Z\",\n    \"status\": \"INVESTIGATING\"\n}\n</code></pre>"},{"location":"#example-creating-impact-for-a-circuit","title":"Example: Creating Impact for a Circuit","text":"<pre><code>POST /api/plugins/notices/impact/\n{\n    \"maintenance\": 1,\n    \"content_type\": \"circuits.circuit\",\n    \"object_id\": 42,\n    \"impact\": \"OUTAGE\"\n}\n</code></pre>"},{"location":"#example-creating-impact-for-a-device","title":"Example: Creating Impact for a Device","text":"<pre><code>POST /api/plugins/notices/impact/\n{\n    \"outage\": 1,\n    \"content_type\": \"dcim.device\",\n    \"object_id\": 123,\n    \"impact\": \"DEGRADED\"\n}\n</code></pre>"},{"location":"#outgoing-notifications","title":"Outgoing Notifications","text":"<p>The plugin supports generating and tracking outgoing notifications to customers and stakeholders about maintenance and outage events.</p>"},{"location":"#key-features_1","title":"Key Features","text":"<ul> <li>Notification Templates: Define Jinja templates for different event types and scenarios</li> <li>Template Scoping: Scope templates to specific tenants, providers, sites, etc. (similar to Config Contexts)</li> <li>Template Inheritance: Base templates can be extended for customization</li> <li>Recipient Discovery: Automatically discover contacts based on roles and priorities</li> <li>Approval Workflow: Notifications go through draft \u2192 ready \u2192 approved \u2192 sent states</li> <li>Delivery Tracking: Track when notifications are sent, delivered, and viewed</li> <li>iCal Support: Generate iCal attachments for maintenance notifications</li> </ul>"},{"location":"#notification-status-workflow","title":"Notification Status Workflow","text":"<ol> <li>Draft: Initial state, notification content can be edited</li> <li>Ready: Content finalized, awaiting approval</li> <li>Approved: Approved by user, ready to send</li> <li>Sent: Dispatched to recipients</li> <li>Delivered: Confirmed delivery</li> <li>Failed: Delivery failed (can be retried)</li> </ol>"},{"location":"#navigation-structure","title":"Navigation Structure","text":"Group Menu Items Notifications Received, Sent Events Planned Maintenances, Outages, Calendar Messaging Notification Templates, Prepared Notifications"},{"location":"#data-models","title":"Data Models","text":"<p>The plugin uses several models to track maintenance, outage, and notification events:</p>"},{"location":"#maintenance","title":"Maintenance","text":"<p>Represents a planned maintenance event from a provider. Key fields:</p> <ul> <li><code>name</code>: Event identifier</li> <li><code>summary</code>: Description of the maintenance</li> <li><code>provider</code>: Foreign key to NetBox Provider</li> <li><code>start</code>, <code>end</code>: Maintenance window times</li> <li><code>status</code>: TENTATIVE, CONFIRMED, CANCELLED, IN-PROCESS, COMPLETED, RE-SCHEDULED, UNKNOWN</li> <li><code>internal_ticket</code>: Your organization's tracking ticket reference</li> <li><code>acknowledged</code>: Whether the event has been acknowledged</li> </ul>"},{"location":"#outage","title":"Outage","text":"<p>Represents an unplanned outage event from a provider. Key fields:</p> <ul> <li><code>name</code>: Event identifier</li> <li><code>summary</code>: Description of the outage</li> <li><code>provider</code>: Foreign key to NetBox Provider</li> <li><code>start</code>, <code>end</code>: Outage window times (end is optional until resolved)</li> <li><code>status</code>: REPORTED, INVESTIGATING, IDENTIFIED, MONITORING, RESOLVED</li> <li><code>estimated_time_to_repair</code>: ETR timestamp (tracked with changelog history)</li> <li><code>internal_ticket</code>: Your organization's tracking ticket reference</li> <li><code>acknowledged</code>: Whether the event has been acknowledged</li> </ul>"},{"location":"#impact","title":"Impact","text":"<p>Links maintenance or outage events to affected NetBox objects using Django's Generic Foreign Key pattern:</p> <ul> <li><code>maintenance</code> or <code>outage</code>: Foreign key to the event (mutually exclusive)</li> <li><code>content_type</code>: The type of affected object (e.g., \"circuits.circuit\", \"dcim.device\")</li> <li><code>object_id</code>: The ID of the affected object</li> <li><code>impact</code>: Impact level - NO-IMPACT, REDUCED-REDUNDANCY, DEGRADED, OUTAGE</li> </ul> <p>The Impact model allows linking events to any NetBox object type configured in <code>allowed_content_types</code>.</p>"},{"location":"#eventnotification","title":"EventNotification","text":"<p>Stores raw email notifications received from providers:</p> <ul> <li><code>maintenance</code> or <code>outage</code>: Foreign key to the associated event</li> <li><code>email</code>: Binary email data</li> <li><code>email_body</code>: Extracted body text</li> <li><code>subject</code>: Email subject line</li> <li><code>email_from</code>: Sender address</li> <li><code>email_received</code>: Receipt timestamp</li> </ul>"},{"location":"#notificationtemplate","title":"NotificationTemplate","text":"<p>Jinja templates for generating outgoing notifications to customers/stakeholders:</p> <ul> <li><code>name</code>, <code>slug</code>: Template identifier</li> <li><code>event_type</code>: Which event types this template applies to (maintenance, outage, or none)</li> <li><code>granularity</code>: How notifications are grouped (per-event, per-tenant, per-contact)</li> <li><code>subject_template</code>, <code>body_template</code>: Jinja templates for email content</li> <li><code>body_format</code>: Output format (markdown, html, plain text)</li> <li><code>contact_roles</code>, <code>contact_priorities</code>: Recipient discovery configuration</li> <li><code>is_base_template</code>, <code>extends</code>: Template inheritance support</li> <li><code>weight</code>: Priority for template matching</li> </ul>"},{"location":"#preparednotification","title":"PreparedNotification","text":"<p>A rendered notification ready for delivery:</p> <ul> <li><code>template</code>: Source NotificationTemplate</li> <li><code>status</code>: Draft, Ready, Approved, Sent, Delivered, Failed</li> <li><code>subject</code>, <code>body_text</code>, <code>body_html</code>: Rendered content snapshot</li> <li><code>contacts</code>, <code>recipients</code>: Recipient list</li> <li><code>approved_by</code>, <code>approved_at</code>: Approval tracking</li> <li><code>sent_at</code>, <code>delivered_at</code>, <code>viewed_at</code>: Delivery tracking</li> </ul>"},{"location":"#sentnotification","title":"SentNotification","text":"<p>A read-only view of PreparedNotifications that have been sent or delivered. This is a proxy model that filters to only show notifications with status \"sent\" or \"delivered\".</p>"},{"location":"#screenshots","title":"Screenshots","text":""},{"location":"#maintenance-event-detail","title":"Maintenance Event Detail","text":"<p>The maintenance detail view shows comprehensive information about a maintenance event including the event timeline, impacted objects, and received notifications.</p> <p></p> <p>Key Features Shown: - Operations dropdown with quick actions (Acknowledge, Reschedule, Mark In-Progress, Mark Completed, Cancel) - Maintenance details with timezone conversion display - Generic impact tracking showing any configured NetBox object type - Received notifications from providers - Event timeline with color-coded status changes</p>"},{"location":"#outage-event-detail","title":"Outage Event Detail","text":"<p>The outage detail view tracks unplanned incidents with ETR (Estimated Time to Repair) and flexible status workflow.</p> <p></p> <p>Key Features Shown: - Outage-specific status workflow (Reported \u2192 Investigating \u2192 Identified \u2192 Monitoring \u2192 Resolved) - ETR tracking with changelog history - Optional end time (required only when resolving) - Impact and notification tracking</p>"},{"location":"#calendar-view_1","title":"Calendar View","text":"<p>Interactive calendar view for visualizing maintenance and outage events with iCal subscription support.</p> <p></p> <p>Click any event to see a quick summary modal with key details:</p> <p></p> <p>Key Features Shown: - FullCalendar integration with month/week/day views - Color-coded events by type (maintenance vs outage) and status - Click-to-view event details modal with status, provider, timing, and summary - iCal Subscribe and Download buttons for calendar integration</p>"},{"location":"#provider-events-widget","title":"Provider Events Widget","text":"<p>A \"Maintenance &amp; Outage Events\" widget appears on Provider detail pages, showing all events from that provider.</p> <p></p> <p>Key Features Shown: - All maintenance and outage events for the provider - Tabbed view with event counts - Event status, timing, and impact count - ETR tracking for outages</p>"},{"location":"#object-event-history-widget","title":"Object Event History Widget","text":"<p>A \"Maintenance &amp; Outage History\" widget automatically appears on the detail pages of any impacted NetBox objects (circuits, devices, sites, etc.). This provides quick visibility into events affecting specific infrastructure.</p> <p></p> <p>Key Features Shown: - Tabbed view separating maintenances and outages - Event counts in tab badges - Links to event details - Status and impact level badges</p>"},{"location":"#credits","title":"Credits","text":"<p>Forked from jasonyates/netbox-circuitmaintenance with significant enhancements including multi-object type support and outage tracking.</p> <p>Based on the NetBox plugin tutorial:</p> <ul> <li>demo repository</li> <li>tutorial</li> </ul> <p>This package was created with Cookiecutter and the <code>netbox-community/cookiecutter-netbox-plugin</code> project template.</p>"},{"location":"changelog/","title":"Changelog","text":""},{"location":"changelog/#changelog","title":"Changelog","text":""},{"location":"changelog/#100-2026-02-09","title":"1.0.0 (2026-02-09)","text":""},{"location":"changelog/#new-features","title":"New Features","text":"<ul> <li>Outgoing Notifications: New notification system for customer/stakeholder communication</li> <li>NotificationTemplate model with Jinja templating support</li> <li>Template scoping (similar to Config Contexts) for tenant/provider/site-specific templates</li> <li>Template inheritance for customization</li> <li>PreparedNotification model with approval workflow (draft \u2192 ready \u2192 sent \u2192 delivered/failed)</li> <li>SentNotification proxy model for viewing sent/delivered notifications</li> <li>Recipient discovery based on contact roles and priorities</li> <li>iCal attachment support for maintenance notifications</li> <li>AWS SES Integration (<code>integrations/aws-ses/</code>): Complete AWS SAM application for email delivery</li> <li>Inbound Lambda \u2014 SES receipt rule \u2192 S3 \u2192 parse with circuit-maintenance-parser \u2192 NetBox API</li> <li>Outbound Lambda \u2014 Poll NetBox for ready notifications \u2192 build MIME \u2192 send via SES</li> <li>Tracking Lambda \u2014 SES delivery events (delivery, bounce, complaint, open, click) via SNS \u2192 NetBox status updates</li> <li>Webhook support via API Gateway for immediate delivery on status change (alternative to polling)</li> <li>Polling and webhook modes independently toggleable (can use either or both)</li> <li>Optional VPC deployment for Lambda functions (private subnets with NAT Gateway)</li> <li>SES Configuration Set with full event tracking (send, delivery, bounce, complaint, open, click)</li> <li>HMAC-SHA512 webhook signature verification for NetBox Event Rules</li> <li>Comprehensive documentation: architecture, quick start, email authentication (SPF, DKIM, DMARC)</li> <li>Developer Tooling: Plugin demo data loader and netbox-demo-data toolkit integration</li> </ul>"},{"location":"changelog/#api-changes","title":"API Changes","text":"<ul> <li>New endpoints for notification management:</li> <li><code>/api/plugins/notices/notification-templates/</code> - CRUD for notification templates</li> <li><code>/api/plugins/notices/prepared-notifications/</code> - CRUD with status workflow</li> <li><code>/api/plugins/notices/sent-notifications/</code> - Read-only view of sent notifications</li> <li>Status transitions support optional <code>timestamp</code> and <code>message</code> fields</li> </ul>"},{"location":"changelog/#ui-changes","title":"UI Changes","text":"<ul> <li>Renamed \"Inbound\" menu item to \"Received\" for clarity</li> <li>New \"Sent\" menu item for viewing sent/delivered notifications</li> <li>New \"Notification Templates\" management UI</li> <li>New \"Prepared Notifications\" management UI with approval workflow</li> </ul>"},{"location":"changelog/#documentation","title":"Documentation","text":"<ul> <li>AWS SES integration guide with architecture diagrams and deployment instructions</li> <li>Outgoing notifications documentation with Slack and SES integration examples</li> <li>Email authentication guide (SPF, DKIM, DMARC, Custom MAIL FROM)</li> <li>Updated parsers documentation with SES cross-references</li> </ul>"},{"location":"changelog/#010-2025-11-18","title":"0.1.0 (2025-11-18)","text":"<p>BREAKING CHANGE: Complete refactor from netbox-circuitmaintenance to netbox-notices</p> <p>This is the initial release of the fully refactored plugin, now supporting both maintenance and outage tracking across multiple NetBox object types.</p>"},{"location":"changelog/#new-features_1","title":"New Features","text":"<ul> <li>Outage Tracking: New Outage model for unplanned outages with automatic timestamps</li> <li>Generic Impact Tracking: Associate impacts with any NetBox object (circuits, devices, VMs, etc.)</li> <li>Reschedule Functionality: Reschedule maintenance events with automatic status updates</li> <li>Timeline View: Visual timeline of all changes and events</li> <li>Choice Constants: All ChoiceSet classes now define constants (STATUS_, IMPACT_)</li> <li>Impact Field: Added impact text field to BaseEvent for describing event impact</li> <li>Reported At: Outage model includes reported_at timestamp with timezone conversion</li> <li>Timezone Support: Automatic timezone conversion and display for all timestamp fields</li> <li>Changelog Tracking: Proper changelog tracking for reschedule operations and related objects</li> <li>PyPI Publishing: Automated GitHub Actions workflow for PyPI releases</li> </ul>"},{"location":"changelog/#api-changes_1","title":"API Changes","text":"<ul> <li>REST API support for Maintenance and Outage models</li> <li>API serializers include all new fields (impact, reported_at, replaces)</li> </ul>"},{"location":"changelog/#infrastructure","title":"Infrastructure","text":"<ul> <li>NetBox 4.4.1+ compatibility</li> <li>Python 3.10+ required</li> <li>Automated CI/CD with GitHub Actions</li> <li>MkDocs documentation with GitHub Pages deployment</li> </ul>"},{"location":"changelog/#migration-notes","title":"Migration Notes","text":"<p>This is a completely new plugin architecture. Previous versions (0.6.0 and earlier as netbox-circuitmaintenance) are not compatible.</p>"},{"location":"changelog/#historical-releases-netbox-circuitmaintenance","title":"Historical Releases (netbox-circuitmaintenance)","text":""},{"location":"changelog/#060-2025-09-08","title":"0.6.0 (2025-09-08)","text":"<ul> <li>Netbox 4.4 support</li> <li>Bug fix by @PetrVoronov</li> <li>Highlight current date in calendar event view</li> </ul>"},{"location":"changelog/#050-2025-06-02","title":"0.5.0 (2025-06-02)","text":"<ul> <li>Netbox 4.2 support</li> </ul>"},{"location":"changelog/#042-2024-09-29","title":"0.4.2 (2024-09-29)","text":"<ul> <li>Adding Maintenance calendar widget</li> <li>Fix #26 - f string quote issue with NB 4.1</li> </ul>"},{"location":"changelog/#041-2024-09-19","title":"0.4.1 (2024-09-19)","text":"<ul> <li>Adding Maintenance Schedule calendar</li> </ul>"},{"location":"changelog/#040-2024-09-19","title":"0.4.0 (2024-09-19)","text":"<ul> <li>Adds support for Netbox 4.0 and 4.1</li> <li>Adds widget to show circuit maintenance events</li> <li>Updates styling to match new Netbox style</li> </ul>"},{"location":"changelog/#030-2023-04-28","title":"0.3.0 (2023-04-28)","text":"<ul> <li>Fixed support for Netbox 3.5. NOTE: Plugin version 0.3.0+ is only compatible with Netbox 3.5+</li> </ul>"},{"location":"changelog/#022-2023-01-18","title":"0.2.2 (2023-01-18)","text":"<ul> <li>Fix API Filtersets</li> <li>Viewing notification content opens a new tab</li> <li>Updating RESCHEDULED to RE-SCHEDULED to match circuitparser</li> </ul>"},{"location":"changelog/#021-2023-01-17","title":"0.2.1 (2023-01-17)","text":"<ul> <li>Updating to DynamicModelChoiceField</li> <li>Hiding maintenance schedule for now</li> </ul>"},{"location":"changelog/#010-2023-01-15","title":"0.1.0 (2023-01-15)","text":"<ul> <li>First release on PyPI.</li> </ul>"},{"location":"contributing/","title":"Contributing","text":""},{"location":"contributing/#contributing","title":"Contributing","text":"<p>Contributions are welcome, and they are greatly appreciated! Every little bit helps, and credit will always be given.</p> <p>You can contribute in many ways:</p>"},{"location":"contributing/#types-of-contributions","title":"Types of Contributions","text":""},{"location":"contributing/#report-bugs","title":"Report Bugs","text":"<p>Report bugs at https://github.com/jsenecal/netbox-notices/issues.</p> <p>If you are reporting a bug, please include:</p> <ul> <li>Your operating system name and version.</li> <li>Any details about your local setup that might be helpful in troubleshooting.</li> <li>Detailed steps to reproduce the bug.</li> </ul>"},{"location":"contributing/#fix-bugs","title":"Fix Bugs","text":"<p>Look through the GitHub issues for bugs. Anything tagged with \"bug\" and \"help wanted\" is open to whoever wants to implement it.</p>"},{"location":"contributing/#implement-features","title":"Implement Features","text":"<p>Look through the GitHub issues for features. Anything tagged with \"enhancement\" and \"help wanted\" is open to whoever wants to implement it.</p>"},{"location":"contributing/#write-documentation","title":"Write Documentation","text":"<p>NetBox Vendor Notification Plugin could always use more documentation, whether as part of the official NetBox Vendor Notification Plugin docs, in docstrings, or even on the web in blog posts, articles, and such.</p>"},{"location":"contributing/#submit-feedback","title":"Submit Feedback","text":"<p>The best way to send feedback is to file an issue at https://github.com/jsenecal/netbox-notices/issues.</p> <p>If you are proposing a feature:</p> <ul> <li>Explain in detail how it would work.</li> <li>Keep the scope as narrow as possible, to make it easier to implement.</li> <li>Remember that contributions are welcome :)</li> </ul>"},{"location":"contributing/#get-started","title":"Get Started!","text":"<p>Ready to contribute? Here's how to set up <code>netbox-notices</code> for local development.</p> <ol> <li>Fork the <code>netbox-notices</code> repo on GitHub.</li> <li> <p>Clone your fork locally</p> <pre><code>$ git clone git@github.com:your_name_here/netbox-notices.git\n</code></pre> </li> <li> <p>Install dependencies and start your virtualenv:</p> <pre><code>$ python3 -m venv venv\n$ source venv/bin/activate\n$ pip install -e \".[dev]\"\n</code></pre> </li> <li> <p>Create a branch for local development:</p> <pre><code>$ git checkout -b name-of-your-bugfix-or-feature\n</code></pre> <p>Now you can make your changes locally.</p> </li> <li> <p>When you're done making changes, check that your changes pass the    tests and linting:</p> <pre><code>$ ./venv/bin/pytest tests/ -v\n$ ./venv/bin/ruff format notices/ tests/\n$ ./venv/bin/ruff check --fix notices/ tests/\n</code></pre> </li> <li> <p>Commit your changes and push your branch to GitHub:</p> <pre><code>$ git add .\n$ git commit -m \"Your detailed description of your changes.\"\n$ git push origin name-of-your-bugfix-or-feature\n</code></pre> </li> <li> <p>Submit a pull request through the GitHub website.</p> </li> </ol>"},{"location":"contributing/#pull-request-guidelines","title":"Pull Request Guidelines","text":"<p>Before you submit a pull request, check that it meets these guidelines:</p> <ol> <li>The pull request should include tests.</li> <li>If the pull request adds functionality, the docs should be updated. Put    your new functionality into a function with a docstring, and add the    feature to the list in README.md.</li> <li>The pull request should work for Python 3.10, 3.11, and 3.12. Check    https://github.com/jsenecal/netbox-notices/actions    and make sure that the tests pass for all supported Python versions.</li> </ol>"},{"location":"contributing/#deploying","title":"Deploying","text":"<p>A reminder for the maintainers on how to deploy. Make sure all your changes are committed (including an entry in CHANGELOG.md). Then run:</p> <pre><code>$ pip install bumpver build twine\n$ bumpver update --patch  # or --minor, --major\n$ python -m build\n$ twine upload dist/*\n</code></pre>"},{"location":"integrations_aws_ses/","title":"AWS SES","text":""},{"location":"integrations_aws_ses/#aws-ses-integration","title":"AWS SES Integration","text":""},{"location":"integrations_aws_ses/#aws-ses-integration-for-netbox-notices","title":"AWS SES Integration for netbox-notices","text":"<p>A self-contained AWS SAM application that provides complete email lifecycle management for the netbox-notices plugin:</p> <ul> <li>Inbound \u2014 Parse provider maintenance emails (SES \u2192 S3 \u2192 Lambda \u2192 NetBox API)</li> <li>Outbound \u2014 Deliver prepared notifications via SES with tracking</li> <li>Tracking \u2014 Process SES delivery events and update notification status in NetBox</li> </ul>"},{"location":"integrations_aws_ses/#architecture","title":"Architecture","text":"<pre><code>                    INBOUND                           OUTBOUND\n                    \u2500\u2500\u2500\u2500\u2500\u2500\u2500                           \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nProvider Email                                    NetBox API\n      \u2502                                          (prepared-notifications)\n      \u25bc                                               \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  AWS SES  \u2502                                    \u2502  Outbound  \u2502\n\u2502 (Receipt) \u2502                                    \u2502   Lambda   \u2502\u25c4\u2500\u2500 EventBridge\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                    \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518    (schedule)\n     \u2502                                                 \u2502\n     \u251c\u2500\u2500\u25ba S3 (raw email)                               \u2502 ses:SendRawEmail\n     \u2502                                                 \u2502 + notification_id tag\n     \u25bc                                                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Inbound  \u2502                                    \u2502  AWS SES  \u2502\n\u2502  Lambda  \u2502\u2500\u2500\u25ba NetBox API                      \u2502 (Send)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    (maintenance,                   \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n                 impact,                              \u2502\n                 eventnotification)                   \u2502\n                                                      \u25bc\n                    TRACKING                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                   \u2502Configuration \u2502\n                                               \u2502    Set       \u2502\n              NetBox API \u25c4\u2500\u2500\u2510                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         (status updates,   \u2502                         \u2502\n          journal entries)  \u2502                         \u25bc\n                            \u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                      \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510            \u2502 SNS Topic\u2502\n                      \u2502 Tracking  \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502  Lambda   \u2502\n                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"integrations_aws_ses/#prerequisites","title":"Prerequisites","text":"<ul> <li>AWS CLI configured with appropriate credentials</li> <li>AWS SAM CLI (<code>pip install aws-sam-cli</code>)</li> <li>Python 3.12 (for local testing)</li> <li>NetBox with the netbox-notices plugin installed and the outgoing notifications feature configured</li> <li>AWS SES \u2014 domain verified for sending (see Email Authentication below); for inbound, domain also needs MX records pointing to SES</li> <li>Network \u2014 Lambda functions must be able to reach the NetBox API over HTTPS. If NetBox is not publicly accessible, see VPC Deployment</li> </ul>"},{"location":"integrations_aws_ses/#quick-start","title":"Quick Start","text":""},{"location":"integrations_aws_ses/#1-clone-and-configure","title":"1. Clone and configure","text":"<pre><code>cd integrations/aws-ses/\n\n# Review and edit parameters in samconfig.toml (optional)\n# Or pass them at deploy time\n</code></pre>"},{"location":"integrations_aws_ses/#2-build","title":"2. Build","text":"<pre><code>sam build\n</code></pre>"},{"location":"integrations_aws_ses/#3-deploy","title":"3. Deploy","text":"<pre><code>sam deploy --guided\n</code></pre> <p>You will be prompted for:</p> Parameter Description <code>NetBoxUrl</code> Your NetBox URL (e.g. <code>https://netbox.example.com</code>) <code>NetBoxApiToken</code> API token with write access to the notices plugin <code>SesReceiptDomain</code> Domain for inbound emails (leave empty to skip inbound) <code>SesFromAddress</code> Verified sender address for outbound emails <code>SesConfigSetName</code> Name for the SES Configuration Set (default: <code>netbox-notices-tracking</code>) <code>EnableOutboundPolling</code> Enable scheduled polling: <code>true</code> or <code>false</code> (default: <code>true</code>) <code>OutboundPollInterval</code> How often to poll for ready notifications (default: <code>rate(5 minutes)</code>) <code>InboundS3BucketName</code> Globally unique S3 bucket name for inbound emails <code>WebhookSecret</code> Shared secret for NetBox webhook signature verification (leave empty to disable webhook) <code>VpcSubnetIds</code> Comma-separated private subnet IDs for VPC deployment (leave empty to skip) <code>VpcSecurityGroupIds</code> Comma-separated security group IDs for VPC deployment (leave empty to skip)"},{"location":"integrations_aws_ses/#4-activate-the-ses-receipt-rule-set-inbound-only","title":"4. Activate the SES Receipt Rule Set (Inbound only)","text":"<p>SES receipt rule sets must be activated manually:</p> <pre><code>aws ses set-active-receipt-rule-set \\\n  --rule-set-name netbox-notices-ses-inbound-rules\n</code></pre> <p>Note: Only one receipt rule set can be active per AWS account in a given region. If you have an existing active rule set, add the receipt rule to it instead.</p>"},{"location":"integrations_aws_ses/#5-verify-it-works","title":"5. Verify it works","text":"<p>Outbound (polling): Create a PreparedNotification in NetBox, approve it (status \u2192 ready), and wait for the next poll interval. The Lambda will pick it up, send via SES, and update the status to <code>sent</code>.</p> <p>Outbound (webhook): Approve a PreparedNotification \u2014 the NetBox Event Rule fires immediately, and the Lambda sends within seconds.</p> <p>Tracking: After the email is delivered, SES publishes a Delivery event to SNS, which triggers the tracking Lambda to update the notification status to <code>delivered</code>.</p> <p>Inbound: Forward a provider maintenance email to your SES receipt domain. The Lambda will parse it and create a Maintenance event in NetBox.</p>"},{"location":"integrations_aws_ses/#configuration-reference","title":"Configuration Reference","text":""},{"location":"integrations_aws_ses/#environment-variables","title":"Environment Variables","text":"<p>All Lambda functions share:</p> Variable Description <code>NETBOX_URL</code> NetBox base URL <code>NETBOX_API_TOKEN</code> API token for NetBox <p>Inbound-specific:</p> Variable Description <code>S3_BUCKET_NAME</code> S3 bucket where SES stores raw emails <code>PROVIDER_MAP</code> JSON object mapping email domains to parser names (optional, has sensible defaults) <p>Outbound-specific:</p> Variable Description <code>SES_FROM_ADDRESS</code> Verified sender email address <code>SES_CONFIGURATION_SET</code> SES Configuration Set name for tracking <code>WEBHOOK_SECRET</code> Shared secret for validating NetBox webhook signatures (optional)"},{"location":"integrations_aws_ses/#provider-map","title":"Provider Map","text":"<p>The inbound Lambda identifies providers by matching the sender's email domain. The default map covers major providers:</p> Domain Provider <code>zayo.com</code> zayo <code>colt.net</code> colt <code>verizonbusiness.com</code> verizon <code>cogentco.com</code> cogent <code>aquacomms.com</code> aquacomms <code>arelion.com</code> arelion <code>amazon.com</code> aws <code>bso.co</code> bso <code>equinix.com</code> equinix <code>lumen.com</code> lumen <code>momentumtelecom.com</code> momentum <code>superonline.net</code> seaborn <code>tisparkle.com</code> sparkle <code>telstra.com</code> telstra <p>Override by setting the <code>PROVIDER_MAP</code> environment variable to a JSON object:</p> <pre><code>{\n  \"zayo.com\": \"zayo\",\n  \"customcarrier.com\": \"genericprovider\"\n}\n</code></pre>"},{"location":"integrations_aws_ses/#ses-event--netbox-status-mapping","title":"SES Event \u2192 NetBox Status Mapping","text":"SES Event NetBox Action Delivery Status \u2192 <code>delivered</code> Bounce Status \u2192 <code>failed</code> Complaint Status \u2192 <code>failed</code> Reject Status \u2192 <code>failed</code> Rendering Failure Status \u2192 <code>failed</code> Send Journal entry (informational) Open Journal entry (informational) Click Journal entry (informational) DeliveryDelay Journal entry (informational)"},{"location":"integrations_aws_ses/#manual-setup","title":"Manual Setup","text":"<p>If you prefer to set up resources manually instead of using SAM:</p>"},{"location":"integrations_aws_ses/#step-1-create-the-s3-bucket","title":"Step 1: Create the S3 Bucket","text":"<p>Create an S3 bucket for inbound emails with a 30-day lifecycle policy. Add a bucket policy allowing SES to write objects:</p> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"AllowSESPuts\",\n      \"Effect\": \"Allow\",\n      \"Principal\": { \"Service\": \"ses.amazonaws.com\" },\n      \"Action\": \"s3:PutObject\",\n      \"Resource\": \"arn:aws:s3:::YOUR-BUCKET/*\",\n      \"Condition\": {\n        \"StringEquals\": { \"AWS:SourceAccount\": \"YOUR-ACCOUNT-ID\" }\n      }\n    }\n  ]\n}\n</code></pre>"},{"location":"integrations_aws_ses/#step-2-create-the-ses-configuration-set","title":"Step 2: Create the SES Configuration Set","text":"<ol> <li>Go to SES \u2192 Configuration sets \u2192 Create set</li> <li>Name it <code>netbox-notices-tracking</code></li> <li>Add an Event destination:</li> <li>Name: <code>sns-tracking</code></li> <li>Events: Send, Delivery, Bounce, Complaint, Reject, Open, Click, Rendering Failure, Delivery Delay</li> <li>Destination: SNS topic (create one, allow SES to publish to it)</li> </ol>"},{"location":"integrations_aws_ses/#step-3-create-lambda-functions","title":"Step 3: Create Lambda Functions","text":"<p>Create three Lambda functions (Python 3.12, 256 MB, 120s timeout) from the <code>functions/</code> directories. Set the environment variables as described above.</p> <p>IAM policies needed:</p> <ul> <li>Inbound: <code>s3:GetObject</code> on the inbound email bucket</li> <li>Outbound: <code>ses:SendRawEmail</code></li> <li>Tracking: No additional policies (only calls NetBox API)</li> </ul>"},{"location":"integrations_aws_ses/#step-4-wire-up-triggers","title":"Step 4: Wire Up Triggers","text":"<ul> <li>Inbound: SES receipt rule \u2192 S3 action (store email) + Lambda action (invoke inbound function)</li> <li>Outbound (polling): EventBridge scheduled rule \u2192 invoke outbound function every N minutes</li> <li>Outbound (webhook): API Gateway HTTP API \u2192 POST /webhook/outbound \u2192 invoke outbound function. Set <code>WEBHOOK_SECRET</code> env var on the Lambda to match the secret in the NetBox Webhook.</li> <li>Tracking: SNS subscription on the tracking topic \u2192 invoke tracking function</li> </ul>"},{"location":"integrations_aws_ses/#step-5-create-ses-receipt-rule-inbound","title":"Step 5: Create SES Receipt Rule (Inbound)","text":"<ol> <li>Go to SES \u2192 Email receiving \u2192 Rule sets</li> <li>Create a rule set and add a rule with:</li> <li>Recipient: your inbound domain</li> <li>Actions: S3 (deliver to bucket) then Lambda (invoke inbound function)</li> <li>Set the rule set as active</li> </ol>"},{"location":"integrations_aws_ses/#local-testing-with-sam","title":"Local Testing with SAM","text":"<p>Use the provided test events for local invoke:</p> <pre><code># Build first\nsam build\n\n# Test inbound (requires S3 bucket with a test email)\nsam local invoke InboundFunction -e events/inbound_ses.json\n\n# Test outbound \u2014 scheduled poll (requires NetBox to be reachable)\nsam local invoke OutboundFunction -e events/outbound_schedule.json\n\n# Test outbound \u2014 webhook trigger (signature will fail without valid HMAC)\nsam local invoke OutboundFunction -e events/outbound_webhook.json\n\n# Test tracking events\nsam local invoke TrackingFunction -e events/tracking_delivery.json\nsam local invoke TrackingFunction -e events/tracking_bounce.json\nsam local invoke TrackingFunction -e events/tracking_open.json\n</code></pre> <p>Override environment variables for local testing:</p> <pre><code>sam local invoke OutboundFunction -e events/outbound_schedule.json \\\n  --env-vars '{\"OutboundFunction\": {\"NETBOX_URL\": \"http://localhost:8008\", \"NETBOX_API_TOKEN\": \"your-token\", \"SES_FROM_ADDRESS\": \"test@example.com\", \"SES_CONFIGURATION_SET\": \"\"}}'\n</code></pre>"},{"location":"integrations_aws_ses/#outbound-delivery-mode","title":"Outbound Delivery Mode","text":"<p>The outbound Lambda supports two independent trigger modes. You choose one or both at deploy time:</p> Mode Trigger Latency Controlled by Polling EventBridge schedule Up to poll interval <code>EnableOutboundPolling</code> (default <code>true</code>) Webhook NetBox Event Rule Seconds <code>WebhookSecret</code> (default empty = off)"},{"location":"integrations_aws_ses/#choosing-a-mode","title":"Choosing a mode","text":"Scenario Parameters Polling only (default) <code>EnableOutboundPolling=true</code> Webhook only <code>EnableOutboundPolling=false</code>, <code>WebhookSecret=&lt;secret&gt;</code> Both (belt-and-suspenders) <code>EnableOutboundPolling=true</code>, <code>WebhookSecret=&lt;secret&gt;</code> <p>When both are enabled, the webhook provides near-instant delivery while the schedule acts as a safety net for any notifications the webhook might miss (the schedule simply skips already-sent notifications).</p>"},{"location":"integrations_aws_ses/#enabling-the-webhook","title":"Enabling the Webhook","text":"<p>Set the <code>WebhookSecret</code> parameter during deployment. This creates an API Gateway HTTP API endpoint and outputs the URL:</p> <pre><code># Webhook only\nsam deploy --parameter-overrides \\\n  EnableOutboundPolling=false \\\n  WebhookSecret=my-secret-value ...\n\n# Both modes\nsam deploy --parameter-overrides \\\n  WebhookSecret=my-secret-value ...\n</code></pre> <p>After deployment, the stack outputs a <code>WebhookUrl</code> like: <pre><code>https://abc123.execute-api.us-east-1.amazonaws.com/prod/webhook/outbound\n</code></pre></p>"},{"location":"integrations_aws_ses/#configuring-netbox","title":"Configuring NetBox","text":"<ol> <li>Go to Operations \u2192 Webhooks and create a new Webhook:</li> </ol> Field Value Name <code>SES Outbound Delivery</code> Payload URL <code>https://abc123.execute-api.../prod/webhook/outbound</code> (from stack outputs) HTTP method <code>POST</code> HTTP content type <code>application/json</code> Secret Same value as <code>WebhookSecret</code> parameter <ol> <li>Go to Operations \u2192 Event Rules and create a new Event Rule:</li> </ol> Field Value Name <code>Send notification on ready</code> Object types <code>Notices &gt; Prepared notification</code> Events <code>Object updated</code> Conditions <code>{\"and\": [{\"attr\": \"status.value\", \"value\": \"ready\"}]}</code> Action type <code>Webhook</code> Action <code>SES Outbound Delivery</code> <p>When a PreparedNotification transitions to <code>ready</code>, NetBox fires the webhook. The Lambda validates the <code>X-Hook-Signature</code> (HMAC-SHA512), fetches the full notification from NetBox, and sends it via SES immediately.</p>"},{"location":"integrations_aws_ses/#security","title":"Security","text":"<p>The webhook endpoint validates every request using NetBox's built-in HMAC-SHA512 signature:</p> <ol> <li>NetBox computes <code>HMAC-SHA512(secret, request_body)</code> and sends it in the <code>X-Hook-Signature</code> header</li> <li>The Lambda recomputes the HMAC with the same secret and uses constant-time comparison</li> <li>Requests with invalid or missing signatures are rejected with HTTP 403</li> </ol>"},{"location":"integrations_aws_ses/#how-it-works","title":"How It Works","text":"<pre><code>NetBox Event Rule                    API Gateway              Outbound Lambda\n     \u2502                                   \u2502                        \u2502\n     \u2502 PreparedNotification              \u2502                        \u2502\n     \u2502 status \u2192 \"ready\"                  \u2502                        \u2502\n     \u2502                                   \u2502                        \u2502\n     \u251c\u2500\u2500\u2500\u2500 POST /webhook/outbound \u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                        \u2502\n     \u2502     X-Hook-Signature: hmac...     \u251c\u2500\u2500\u2500\u2500\u2500 invoke \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n     \u2502     {event, model, data...}       \u2502                        \u2502\n     \u2502                                   \u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n     \u2502                                   \u2502         \u2502 1. Verify    \u2502\n     \u2502                                   \u2502         \u2502    signature \u2502\n     \u2502                                   \u2502         \u2502 2. Fetch     \u2502\n     \u2502                                   \u2502         \u2502    full      \u2502\n     \u2502                                   \u2502         \u2502    notif.    \u2502\n     \u2502                                   \u2502         \u2502 3. Send SES  \u2502\n     \u2502                                   \u2502         \u2502 4. PATCH     \u2502\n     \u2502                                   \u2502         \u2502    \u2192 \"sent\"  \u2502\n     \u2502                                   \u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n     \u2502                                   \u2502\u25c4\u2500\u2500\u2500\u2500 200 OK \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n</code></pre>"},{"location":"integrations_aws_ses/#vpc-deployment","title":"VPC Deployment","text":"<p>By default, Lambda functions run outside a VPC and access NetBox over the public internet. If NetBox is on a private network, deploy the Lambdas into a VPC with connectivity to it.</p>"},{"location":"integrations_aws_ses/#when-you-need-vpc","title":"When you need VPC","text":"<ul> <li>NetBox is behind a firewall, VPN, or private subnet</li> <li>You need a predictable source IP to allowlist (via NAT Gateway Elastic IP)</li> <li>Security policy requires all traffic to stay within the AWS network</li> </ul>"},{"location":"integrations_aws_ses/#network-requirements","title":"Network requirements","text":"<p>Lambda functions in a VPC need outbound internet access for:</p> <ul> <li>NetBox API (HTTPS) \u2014 all three functions</li> <li>AWS SES API (HTTPS) \u2014 outbound function (<code>ses:SendRawEmail</code>)</li> <li>AWS S3 API (HTTPS) \u2014 inbound function (fetch raw email)</li> </ul> <p>This requires either:</p> <ol> <li>NAT Gateway in a public subnet (most common) \u2014 gives Lambda internet access and a static Elastic IP</li> <li>VPC Endpoints for S3 and SES (avoids NAT for AWS services, but still need NAT or direct connectivity for NetBox if it's external)</li> </ol>"},{"location":"integrations_aws_ses/#setup","title":"Setup","text":"<ol> <li>Create or identify private subnets with a route to a NAT Gateway</li> <li>Create a security group that allows outbound HTTPS (port 443)</li> <li>Deploy with VPC parameters:</li> </ol> <pre><code>sam deploy --parameter-overrides \\\n  VpcSubnetIds=subnet-aaa,subnet-bbb \\\n  VpcSecurityGroupIds=sg-xxx ...\n</code></pre> <p>SAM automatically attaches the <code>AWSLambdaVPCAccessExecutionRole</code> managed policy (ENI permissions) when VPC config is present.</p>"},{"location":"integrations_aws_ses/#static-ip-for-firewall-allowlisting","title":"Static IP for firewall allowlisting","text":"<p>When Lambda runs in a VPC with a NAT Gateway, all outbound traffic exits through the NAT Gateway's Elastic IP. Allowlist that IP on your firewall to grant Lambda access to NetBox:</p> <pre><code># Find your NAT Gateway's Elastic IP\naws ec2 describe-nat-gateways --filter Name=subnet-id,Values=subnet-public \\\n  --query 'NatGateways[].NatGatewayAddresses[].PublicIp'\n</code></pre>"},{"location":"integrations_aws_ses/#email-authentication","title":"Email Authentication","text":"<p>For outbound emails to be delivered reliably and not marked as spam, configure these DNS records for your sending domain.</p>"},{"location":"integrations_aws_ses/#spf-sender-policy-framework","title":"SPF (Sender Policy Framework)","text":"<p>SPF tells receiving mail servers that SES is authorized to send on behalf of your domain. Add a TXT record:</p> <pre><code>v=spf1 include:amazonses.com ~all\n</code></pre> <p>If you already have an SPF record, add <code>include:amazonses.com</code> to it.</p>"},{"location":"integrations_aws_ses/#dkim-domainkeys-identified-mail","title":"DKIM (DomainKeys Identified Mail)","text":"<p>DKIM cryptographically signs emails so recipients can verify they haven't been tampered with. SES provides Easy DKIM:</p> <ol> <li>Go to SES \u2192 Verified identities \u2192 your domain</li> <li>Under Authentication, select Easy DKIM</li> <li>SES generates three CNAME records \u2014 add them to your DNS:</li> </ol> <pre><code>selector1._domainkey.example.com  CNAME  selector1.dkim.amazonses.com\nselector2._domainkey.example.com  CNAME  selector2.dkim.amazonses.com\nselector3._domainkey.example.com  CNAME  selector3.dkim.amazonses.com\n</code></pre> <p>Once DNS propagates, SES automatically signs all outbound emails.</p>"},{"location":"integrations_aws_ses/#dmarc-domain-based-message-authentication-reporting--conformance","title":"DMARC (Domain-based Message Authentication, Reporting &amp; Conformance)","text":"<p>DMARC builds on SPF and DKIM to tell receivers what to do with messages that fail authentication. Add a TXT record:</p> <pre><code>_dmarc.example.com  TXT  \"v=DMARC1; p=quarantine; rua=mailto:dmarc-reports@example.com\"\n</code></pre> Policy Meaning <code>p=none</code> Monitor only (start here) <code>p=quarantine</code> Send failures to spam <code>p=reject</code> Reject failures outright <p>Start with <code>p=none</code> to collect reports, then tighten to <code>quarantine</code> or <code>reject</code> once you've confirmed everything is working.</p>"},{"location":"integrations_aws_ses/#custom-mail-from-domain-optional","title":"Custom MAIL FROM domain (optional)","text":"<p>By default, SES uses <code>amazonses.com</code> as the MAIL FROM domain. For full SPF alignment (required for strict DMARC), configure a custom MAIL FROM:</p> <ol> <li>Go to SES \u2192 Verified identities \u2192 your domain \u2192 Custom MAIL FROM domain</li> <li>Set it to a subdomain (e.g. <code>mail.example.com</code>)</li> <li>Add the MX and TXT records SES provides:</li> </ol> <pre><code>mail.example.com  MX   10 feedback-smtp.us-east-1.amazonses.com\nmail.example.com  TXT  \"v=spf1 include:amazonses.com ~all\"\n</code></pre>"},{"location":"integrations_aws_ses/#inbound-mx-records","title":"Inbound MX records","text":"<p>For the inbound flow (receiving provider maintenance emails), point your receipt domain's MX record to SES:</p> <pre><code>notices.example.com  MX  10 inbound-smtp.us-east-1.amazonaws.com\n</code></pre> <p>Use the correct regional endpoint for your SES region.</p>"},{"location":"integrations_aws_ses/#customization","title":"Customization","text":""},{"location":"integrations_aws_ses/#multiple-recipients-per-notification","title":"Multiple Recipients per Notification","text":"<p>Each PreparedNotification can have multiple recipients. The outbound Lambda sends a single email with all recipients in the <code>To:</code> header. For individual emails per recipient, modify <code>_build_mime()</code> to iterate over recipients.</p>"},{"location":"integrations_aws_ses/#html-styling","title":"HTML Styling","text":"<p>The outbound Lambda inlines CSS from the notification's <code>css</code> field into a <code>&lt;style&gt;</code> tag in the HTML <code>&lt;head&gt;</code>. For more aggressive CSS inlining (into element <code>style</code> attributes), consider adding a library like <code>premailer</code>.</p>"},{"location":"integrations_aws_ses/#troubleshooting","title":"Troubleshooting","text":""},{"location":"integrations_aws_ses/#outbound-lambda-sends-but-status-not-updated","title":"Outbound Lambda sends but status not updated","text":"<p>Check CloudWatch Logs for the outbound Lambda. Common causes: - NetBox API token doesn't have write permission - NetBox URL is not reachable from Lambda (check VPC/security groups)</p>"},{"location":"integrations_aws_ses/#tracking-events-not-arriving","title":"Tracking events not arriving","text":"<ol> <li>Verify the SES Configuration Set is attached to outbound emails (check <code>SES_CONFIGURATION_SET</code> env var)</li> <li>Verify the SNS topic policy allows SES to publish</li> <li>Check that the Lambda has an SNS trigger subscription</li> </ol>"},{"location":"integrations_aws_ses/#inbound-emails-not-parsed","title":"Inbound emails not parsed","text":"<ol> <li>Check S3 bucket for the raw email (SES should store it)</li> <li>Check CloudWatch Logs for the inbound Lambda</li> <li>Verify the sender matches a provider in the provider map</li> <li>Ensure the email format is supported by <code>circuit-maintenance-parser</code></li> </ol>"},{"location":"integrations_aws_ses/#ses-sending-in-sandbox","title":"SES sending in sandbox","text":"<p>New SES accounts start in sandbox mode (can only send to verified addresses). Request production access in the SES console.</p>"},{"location":"integrations_aws_ses/#permission-errors","title":"Permission errors","text":"<p>Ensure the NetBox API token has permission to: - Read/write <code>notices.maintenance</code>, <code>notices.impact</code>, <code>notices.eventnotification</code> - Read/write <code>notices.preparednotification</code> - Create <code>extras.journalentry</code></p>"},{"location":"outgoing-notifications/","title":"Outgoing Notifications","text":""},{"location":"outgoing-notifications/#outgoing-notifications","title":"Outgoing Notifications","text":"<p>This document describes the outgoing notification system in netbox-notices for composing and preparing messages based on maintenance and outage events.</p>"},{"location":"outgoing-notifications/#overview","title":"Overview","text":"<p>The outgoing notifications feature provides a complete message composition system that:</p> <ul> <li>Composes messages from Jinja2 templates with full access to event and impact data</li> <li>Discovers recipients automatically from NetBox contacts via tenant relationships</li> <li>Generates iCal attachments for maintenance events following the BCOP standard</li> <li>Tracks message lifecycle from draft through delivery with full audit trail</li> </ul> <p>This is a content/delivery separation architecture:</p> <ul> <li>This plugin handles: Templates, recipient discovery, message composition, and state tracking</li> <li>External systems handle: Actual delivery (SMTP, Slack, Teams, webhooks, etc.)</li> </ul>"},{"location":"outgoing-notifications/#architecture","title":"Architecture","text":"<pre><code>                                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                    \u2502   Maintenance or    \u2502\n                                    \u2502   Outage Event      \u2502\n                                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                               \u2502\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502                          \u2502                          \u2502\n                    \u25bc                          \u25bc                          \u25bc\n           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n           \u2502 MessageTemplate\u2502        \u2502  TemplateScope \u2502        \u2502   Contacts     \u2502\n           \u2502   (Jinja2)     \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502   (Matching)   \u2502        \u2502  (Recipients)  \u2502\n           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502                                                   \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                       \u2502\n                                       \u25bc\n                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502PreparedMessage \u2502\n                              \u2502  (Rendered)    \u2502\n                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                       \u2502\n                                       \u25bc\n                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502   REST API     \u2502\n                              \u2502 (Pull Model)   \u2502\n                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                       \u2502\n                                       \u25bc\n                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                              \u2502 External       \u2502\n                              \u2502 Delivery       \u2502\n                              \u2502 System         \u2502\n                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"outgoing-notifications/#models","title":"Models","text":""},{"location":"outgoing-notifications/#messagetemplate","title":"MessageTemplate","text":"<p>A Jinja template for generating outgoing notifications. Templates can be scoped to specific objects (tenants, providers, sites, etc.) via TemplateScope assignments, similar to Config Contexts.</p> Field Type Description <code>name</code> CharField Human-readable template name <code>slug</code> SlugField URL-safe identifier (unique) <code>description</code> TextField Optional description <code>event_type</code> CharField Which events this applies to: <code>maintenance</code>, <code>outage</code>, <code>both</code>, or <code>none</code> <code>granularity</code> CharField Message grouping: <code>per_event</code>, <code>per_tenant</code>, or <code>per_impact</code> <code>subject_template</code> TextField Jinja template for email subject <code>body_template</code> TextField Jinja template for message body <code>body_format</code> CharField Output format: <code>markdown</code>, <code>html</code>, or <code>text</code> <code>css_template</code> TextField CSS styles for HTML output <code>headers_template</code> JSONField Email headers as Jinja templates <code>include_ical</code> BooleanField Generate iCal attachment (Maintenance only) <code>ical_template</code> TextField Jinja template for iCal content <code>contact_roles</code> M2M Contact roles to include in recipient discovery <code>contact_priorities</code> ArrayField Contact priorities: <code>primary</code>, <code>secondary</code>, <code>tertiary</code> <code>is_base_template</code> BooleanField Whether this can be extended by other templates <code>extends</code> ForeignKey Parent template for Jinja block inheritance <code>weight</code> IntegerField Base weight for template matching (higher wins)"},{"location":"outgoing-notifications/#templatescope","title":"TemplateScope","text":"<p>Links a MessageTemplate to NetBox objects for Config Context-like matching. When generating messages, templates with matching scopes are selected and merged by weight.</p> Field Type Description <code>template</code> ForeignKey Parent MessageTemplate <code>content_type</code> ForeignKey Type of object (e.g., Tenant, Provider, Site) <code>object_id</code> BigIntegerField Specific object ID, or null for all of that type <code>event_type</code> CharField Filter by event type (optional) <code>event_status</code> CharField Filter by event status (optional) <code>weight</code> IntegerField Weight for merge priority (higher wins)"},{"location":"outgoing-notifications/#preparedmessage","title":"PreparedMessage","text":"<p>A rendered message ready for delivery. Stores a snapshot of rendered content and recipients at generation time. Status transitions are validated via state machine.</p> Field Type Description <code>template</code> ForeignKey Source MessageTemplate <code>event_content_type</code> ForeignKey Type of linked event (optional) <code>event_id</code> BigIntegerField ID of linked event (optional) <code>status</code> CharField Current status: <code>draft</code>, <code>ready</code>, <code>sent</code>, <code>delivered</code>, <code>failed</code> <code>contacts</code> M2M Contacts to receive this message <code>recipients</code> JSONField Snapshot of recipients at approval time (read-only) <code>subject</code> CharField Rendered subject line <code>body_text</code> TextField Rendered plain text body <code>body_html</code> TextField Rendered HTML body <code>headers</code> JSONField Rendered email headers <code>css</code> TextField Rendered CSS <code>ical_content</code> TextField Rendered iCal attachment <code>approved_by</code> ForeignKey User who approved the message <code>approved_at</code> DateTimeField When the message was approved <code>sent_at</code> DateTimeField When the message was sent <code>delivered_at</code> DateTimeField When delivery was confirmed <code>viewed_at</code> DateTimeField When the message was viewed"},{"location":"outgoing-notifications/#template-creation","title":"Template Creation","text":""},{"location":"outgoing-notifications/#event-type-targeting","title":"Event Type Targeting","text":"<p>The <code>event_type</code> field determines which events a template can be used with:</p> Value Description <code>maintenance</code> Only for Maintenance events <code>outage</code> Only for Outage events <code>both</code> For both Maintenance and Outage events <code>none</code> Standalone messages not linked to events"},{"location":"outgoing-notifications/#granularity","title":"Granularity","text":"<p>The <code>granularity</code> field controls how messages are grouped when generated from events:</p> Value Description <code>per_event</code> One message for the entire event (all impacts in one message) <code>per_tenant</code> One message per affected tenant (group impacts by tenant) <code>per_impact</code> One message per impact record (individual notifications)"},{"location":"outgoing-notifications/#template-syntax","title":"Template Syntax","text":"<p>Templates use Jinja2 syntax with full support for:</p> <ul> <li>Variable interpolation: <code>{{ maintenance.name }}</code></li> <li>Conditionals: <code>{% if maintenance.status == 'CONFIRMED' %}...{% endif %}</code></li> <li>Loops: <code>{% for impact in impacts %}...{% endfor %}</code></li> <li>Filters: <code>{{ maintenance.start|ical_datetime }}</code></li> <li>Block inheritance: <code>{% extends \"base\" %}{% block content %}...{% endblock %}</code></li> </ul> <p>Example subject template:</p> <pre><code>[{{ maintenance.status }}] {{ maintenance.provider.name }} Maintenance: {{ maintenance.name }}\n</code></pre> <p>Example body template:</p> <pre><code># Maintenance Notification\n\n**Provider:** {{ maintenance.provider.name }}\n**Maintenance ID:** {{ maintenance.name }}\n**Status:** {{ maintenance.status }}\n\n## Schedule\n\n- **Start:** {{ maintenance.start }}\n- **End:** {{ maintenance.end }}\n\n## Affected Services\n\n{% for impact in tenant_impacts %}\n- {{ impact.target }} ({{ impact.impact }})\n{% endfor %}\n\n## Summary\n\n{{ maintenance.summary }}\n\n---\nThis is an automated notification from NetBox.\nView details: {{ netbox_url }}{{ maintenance.get_absolute_url }}\n</code></pre>"},{"location":"outgoing-notifications/#context-variables","title":"Context Variables","text":""},{"location":"outgoing-notifications/#all-templates","title":"All Templates","text":"Variable Description <code>now</code> Current datetime <code>netbox_url</code> NetBox base URL <code>tenant</code> Target tenant (when using per_tenant granularity) <code>impacts</code> All Impact records for this message scope <code>contacts</code> List of recipient Contact objects"},{"location":"outgoing-notifications/#maintenance-event-linked","title":"Maintenance Event-Linked","text":"Variable Description <code>maintenance</code> The Maintenance object <code>maintenance.provider</code> Provider object <code>maintenance.status</code> Current status (TENTATIVE, CONFIRMED, etc.) <code>maintenance.start</code> Scheduled start time <code>maintenance.end</code> Scheduled end time <code>maintenance.summary</code> Maintenance summary text <code>tenant_impacts</code> Impacts filtered for current tenant <code>highest_impact</code> Worst impact level (OUTAGE &gt; DEGRADED &gt; REDUCED-REDUNDANCY &gt; NO-IMPACT) <code>message_sequence</code> Notification count for this tenant+event"},{"location":"outgoing-notifications/#outage-event-linked","title":"Outage Event-Linked","text":"Variable Description <code>outage</code> The Outage object <code>outage.reported_at</code> When the outage was reported <code>outage.estimated_time_to_repair</code> ETR if known <code>outage.status</code> Current status (REPORTED, INVESTIGATING, etc.) <code>outage.end</code> Resolution time (if resolved)"},{"location":"outgoing-notifications/#per-impact-granularity","title":"Per-Impact Granularity","text":"Variable Description <code>impact</code> The specific Impact record <code>impact.target</code> The impacted object <code>object</code> Alias for <code>impact.target</code>"},{"location":"outgoing-notifications/#custom-filters","title":"Custom Filters","text":""},{"location":"outgoing-notifications/#ical_datetime","title":"ical_datetime","text":"<p>Formats a datetime as an iCal-compliant datetime string (YYYYMMDDTHHMMSSZ in UTC).</p> <pre><code>DTSTART:{{ maintenance.start|ical_datetime }}\n</code></pre> <p>Output: <code>DTSTART:20260122T143000Z</code></p>"},{"location":"outgoing-notifications/#markdown","title":"markdown","text":"<p>Renders Markdown text to HTML. Supports tables, fenced code blocks, and line breaks.</p> <pre><code>{{ maintenance.summary|markdown }}\n</code></pre>"},{"location":"outgoing-notifications/#recipient-discovery","title":"Recipient Discovery","text":"<p>Recipients are discovered automatically from NetBox contacts based on the template configuration:</p>"},{"location":"outgoing-notifications/#flow","title":"Flow","text":"<ol> <li>Collect target objects from event impacts based on granularity</li> <li>Resolve tenants from impacted objects via <code>object.tenant</code></li> <li>Find contacts by querying ContactAssignments where:</li> <li>Role is in template's <code>contact_roles</code></li> <li>Priority is in template's <code>contact_priorities</code></li> <li>Priority is not <code>inactive</code></li> <li>Populate PreparedMessage with discovered contacts</li> <li>Snapshot recipients when message transitions to <code>ready</code> status</li> </ol>"},{"location":"outgoing-notifications/#example","title":"Example","text":"<p>A maintenance event impacts two circuits:</p> <ul> <li>Circuit A belongs to Tenant X</li> <li>Circuit B belongs to Tenant Y</li> </ul> <p>With <code>granularity=per_tenant</code> and <code>contact_roles=[NOC]</code>:</p> <ol> <li>System creates two PreparedMessages (one per tenant)</li> <li>For Tenant X's message, discovers contacts with NOC role assigned to Tenant X</li> <li>For Tenant Y's message, discovers contacts with NOC role assigned to Tenant Y</li> </ol>"},{"location":"outgoing-notifications/#standalone-messages","title":"Standalone Messages","text":"<p>For templates with <code>event_type=none</code>:</p> <ul> <li>No automatic recipient discovery</li> <li>User manually selects contacts while in <code>draft</code> status</li> <li>Same approval and delivery flow applies</li> </ul>"},{"location":"outgoing-notifications/#template-matching","title":"Template Matching","text":"<p>When generating messages from an event, templates are matched and merged based on scopes.</p>"},{"location":"outgoing-notifications/#matching-algorithm","title":"Matching Algorithm","text":"<ol> <li>Filter by event type:</li> <li>Maintenance events match templates where <code>event_type</code> is <code>maintenance</code> or <code>both</code></li> <li> <p>Outage events match templates where <code>event_type</code> is <code>outage</code> or <code>both</code></p> </li> <li> <p>Score templates by scope matches: <pre><code>score = template.weight\nfor each scope in template.scopes:\n    if scope matches context:\n        score += scope.weight\n</code></pre></p> </li> <li> <p>Select templates:</p> </li> <li>Include templates with at least one matching scope</li> <li>Include templates with no scopes (global defaults)</li> </ol>"},{"location":"outgoing-notifications/#scope-matching","title":"Scope Matching","text":"<p>A scope matches when:</p> <ul> <li>Its <code>content_type</code> matches an object in the context (tenant, provider, etc.)</li> <li>Its <code>object_id</code> is null (matches all of that type) OR matches the specific object</li> <li>Its <code>event_type</code> is null OR matches the current event type</li> <li>Its <code>event_status</code> is null OR matches the current event status</li> </ul>"},{"location":"outgoing-notifications/#field-level-merging","title":"Field-Level Merging","text":"<p>When multiple templates match, fields are merged by weight (higher wins):</p> <ul> <li><code>subject_template</code></li> <li><code>body_template</code></li> <li><code>headers_template</code></li> <li><code>css_template</code></li> <li><code>ical_template</code></li> </ul> <p>If a higher-weighted template's field is empty/null, the value is inherited from lower-weighted templates.</p>"},{"location":"outgoing-notifications/#ical-generation","title":"iCal Generation","text":""},{"location":"outgoing-notifications/#when-generated","title":"When Generated","text":"<p>iCal attachments are generated when:</p> <ol> <li>Template has <code>include_ical=True</code></li> <li>Message is linked to a Maintenance event (not Outage)</li> <li>Template has a non-empty <code>ical_template</code></li> </ol>"},{"location":"outgoing-notifications/#bcop-standard","title":"BCOP Standard","text":"<p>The iCal format follows the BCOP (Best Current Operational Practice) standard for circuit maintenance notifications.</p>"},{"location":"outgoing-notifications/#required-x-maintnote--properties","title":"Required X-MAINTNOTE-* Properties","text":"Property Description <code>X-MAINTNOTE-PROVIDER</code> Service provider identifier (e.g., provider slug) <code>X-MAINTNOTE-ACCOUNT</code> Customer account identifier (e.g., tenant name) <code>X-MAINTNOTE-MAINTENANCE-ID</code> Unique maintenance identifier <code>X-MAINTNOTE-OBJECT-ID</code> Affected service/circuit ID(s) <code>X-MAINTNOTE-IMPACT</code> Impact level: NO-IMPACT, REDUCED-REDUNDANCY, DEGRADED, OUTAGE <code>X-MAINTNOTE-STATUS</code> Status: TENTATIVE, CONFIRMED, CANCELLED, IN-PROCESS, COMPLETED"},{"location":"outgoing-notifications/#example-bcop-template","title":"Example BCOP Template","text":"<pre><code>BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//YourCompany//netbox-notices//EN\nMETHOD:REQUEST\nBEGIN:VEVENT\nDTSTAMP:{{ now|ical_datetime }}\nDTSTART:{{ maintenance.start|ical_datetime }}\nDTEND:{{ maintenance.end|ical_datetime }}\nUID:{{ maintenance.pk }}-{{ tenant.pk }}@yourcompany.com\nSUMMARY:{{ maintenance.name }} - {{ maintenance.provider.name }}\nDESCRIPTION:{{ maintenance.summary | replace('\\n', '\\\\n') }}\nORGANIZER;CN=\"{{ maintenance.provider.name }}\":mailto:noc@yourcompany.com\nSEQUENCE:{{ message_sequence|default(0) }}\nX-MAINTNOTE-PROVIDER:{{ maintenance.provider.slug }}\nX-MAINTNOTE-ACCOUNT:{{ tenant.name }}\nX-MAINTNOTE-MAINTENANCE-ID;X-MAINTNOTE-PRECEDENCE=PRIMARY:{{ maintenance.name }}\n{% for impact in tenant_impacts %}\nX-MAINTNOTE-OBJECT-ID:{{ impact.target }}\n{% endfor %}\nX-MAINTNOTE-IMPACT:{{ highest_impact }}\nX-MAINTNOTE-STATUS:{{ maintenance.status }}\nEND:VEVENT\nEND:VCALENDAR\n</code></pre>"},{"location":"outgoing-notifications/#state-machine","title":"State Machine","text":"<p>PreparedMessage status transitions are enforced by a state machine with validation.</p>"},{"location":"outgoing-notifications/#status-workflow","title":"Status Workflow","text":"<pre><code>         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502                                 \u2502\n         \u25bc                                 \u2502\n      [draft] \u2500\u2500\u2500\u2500\u2500\u2500&gt; [ready] \u2500\u2500\u2500\u2500\u2500\u2500&gt; [sent] \u2500\u2500\u2500\u2500\u2500\u2500&gt; [delivered]\n         \u2502               \u2502                \u2502\n         \u2502               \u2502                \u2502\n         \u25bc               \u2502                \u25bc\n      (delete)           \u2502            [failed]\n                         \u2502                \u2502\n                         \u2502                \u2502\n                         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              (retry)\n</code></pre>"},{"location":"outgoing-notifications/#valid-transitions","title":"Valid Transitions","text":"From To Trigger <code>draft</code> <code>ready</code> Approve message <code>draft</code> (delete) Delete draft <code>ready</code> <code>sent</code> External system picks up message <code>sent</code> <code>delivered</code> Delivery confirmed <code>sent</code> <code>failed</code> Delivery failed <code>failed</code> <code>ready</code> Retry delivery"},{"location":"outgoing-notifications/#validation-requirements","title":"Validation Requirements","text":"<p>draft -&gt; ready (approval):</p> <ul> <li><code>recipients</code> must not be empty (computed from <code>contacts</code>)</li> <li>Sets <code>approved_by</code> to current user</li> <li>Sets <code>approved_at</code> to current timestamp</li> <li>Snapshots recipients JSON from contacts</li> </ul> <p>ready -&gt; sent:</p> <ul> <li>Sets <code>sent_at</code> to provided <code>timestamp</code> or current time</li> </ul> <p>sent -&gt; delivered:</p> <ul> <li>Sets <code>delivered_at</code> to provided <code>timestamp</code> or current time</li> </ul>"},{"location":"outgoing-notifications/#optional-timestamp-parameter","title":"Optional Timestamp Parameter","text":"<p>External delivery systems may process messages in batches or have delayed polling. The <code>timestamp</code> parameter allows specifying when a transition actually occurred:</p> <pre><code>PATCH /api/plugins/notices/prepared-messages/1/\n{\n    \"status\": \"sent\",\n    \"timestamp\": \"2026-01-27T10:00:00Z\",\n    \"message\": \"Sent via batch processor\"\n}\n</code></pre> <p>Timestamp validation:</p> <ul> <li>Cannot be in the future</li> <li>Must respect chronological order:</li> <li><code>sent_at</code> &gt;= <code>approved_at</code></li> <li><code>delivered_at</code> &gt;= <code>sent_at</code></li> </ul> <p>If <code>timestamp</code> is not provided, the current time is used.</p>"},{"location":"outgoing-notifications/#rest-api","title":"REST API","text":""},{"location":"outgoing-notifications/#endpoints","title":"Endpoints","text":"<pre><code>GET    /api/plugins/notices/message-templates/\nPOST   /api/plugins/notices/message-templates/\nGET    /api/plugins/notices/message-templates/{id}/\nPUT    /api/plugins/notices/message-templates/{id}/\nPATCH  /api/plugins/notices/message-templates/{id}/\nDELETE /api/plugins/notices/message-templates/{id}/\n\nGET    /api/plugins/notices/prepared-messages/\nPOST   /api/plugins/notices/prepared-messages/\nGET    /api/plugins/notices/prepared-messages/{id}/\nPATCH  /api/plugins/notices/prepared-messages/{id}/\nDELETE /api/plugins/notices/prepared-messages/{id}/\n</code></pre>"},{"location":"outgoing-notifications/#filtering-preparedmessages","title":"Filtering PreparedMessages","text":"<p>Query messages by status for delivery system integration:</p> <pre><code>GET /api/plugins/notices/prepared-messages/?status=ready\n</code></pre>"},{"location":"outgoing-notifications/#creating-a-messagetemplate","title":"Creating a MessageTemplate","text":"<pre><code>POST /api/plugins/notices/message-templates/\nContent-Type: application/json\nAuthorization: Token YOUR_API_TOKEN\n\n{\n    \"name\": \"Maintenance Notification\",\n    \"slug\": \"maintenance-notification\",\n    \"event_type\": \"maintenance\",\n    \"granularity\": \"per_tenant\",\n    \"subject_template\": \"[{{ maintenance.status }}] {{ maintenance.provider.name }}: {{ maintenance.name }}\",\n    \"body_template\": \"# Maintenance Notice\\n\\n{{ maintenance.summary }}\",\n    \"body_format\": \"markdown\",\n    \"include_ical\": true,\n    \"ical_template\": \"BEGIN:VCALENDAR\\n...\\nEND:VCALENDAR\",\n    \"contact_priorities\": [\"primary\", \"secondary\"],\n    \"weight\": 1000\n}\n</code></pre> <p>Response:</p> <pre><code>{\n    \"id\": 1,\n    \"url\": \"/api/plugins/notices/message-templates/1/\",\n    \"display\": \"Maintenance Notification\",\n    \"name\": \"Maintenance Notification\",\n    \"slug\": \"maintenance-notification\",\n    \"event_type\": \"maintenance\",\n    \"granularity\": \"per_tenant\",\n    ...\n}\n</code></pre>"},{"location":"outgoing-notifications/#creating-a-preparedmessage","title":"Creating a PreparedMessage","text":"<pre><code>POST /api/plugins/notices/prepared-messages/\nContent-Type: application/json\nAuthorization: Token YOUR_API_TOKEN\n\n{\n    \"template_id\": 1,\n    \"event_content_type\": \"maintenance\",\n    \"event_id\": 42,\n    \"subject\": \"Scheduled Maintenance: MAINT-001\",\n    \"body_text\": \"This is a test notification...\",\n    \"contact_ids\": [1, 2, 3]\n}\n</code></pre>"},{"location":"outgoing-notifications/#updating-message-status","title":"Updating Message Status","text":"<p>External delivery systems update status after processing:</p> <p>Mark as sent:</p> <pre><code>PATCH /api/plugins/notices/prepared-messages/1/\nContent-Type: application/json\nAuthorization: Token YOUR_API_TOKEN\n\n{\n    \"status\": \"sent\",\n    \"message\": \"Sent via SMTP relay\"\n}\n</code></pre> <p>Mark as sent with custom timestamp (for batch processing):</p> <pre><code>PATCH /api/plugins/notices/prepared-messages/1/\nContent-Type: application/json\nAuthorization: Token YOUR_API_TOKEN\n\n{\n    \"status\": \"sent\",\n    \"timestamp\": \"2026-01-22T10:30:00Z\",\n    \"message\": \"Sent via batch processor\"\n}\n</code></pre> <p>Mark as delivered:</p> <pre><code>PATCH /api/plugins/notices/prepared-messages/1/\nContent-Type: application/json\nAuthorization: Token YOUR_API_TOKEN\n\n{\n    \"status\": \"delivered\",\n    \"timestamp\": \"2026-01-22T10:31:00Z\",\n    \"message\": \"Delivered to 5 recipients\"\n}\n</code></pre> <p>Mark as failed (for retry):</p> <pre><code>PATCH /api/plugins/notices/prepared-messages/1/\nContent-Type: application/json\nAuthorization: Token YOUR_API_TOKEN\n\n{\n    \"status\": \"failed\",\n    \"message\": \"SMTP connection refused\"\n}\n</code></pre>"},{"location":"outgoing-notifications/#journal-entries","title":"Journal Entries","text":"<p>When a <code>message</code> field is included in status updates, a journal entry is automatically created:</p> New Status Journal Kind <code>ready</code> info <code>sent</code> info <code>delivered</code> success <code>failed</code> warning"},{"location":"outgoing-notifications/#integration","title":"Integration","text":""},{"location":"outgoing-notifications/#pull-based-api-model","title":"Pull-Based API Model","text":"<p>The recommended integration pattern is pull-based:</p> <ol> <li> <p>External delivery system polls for ready messages:    <pre><code>GET /api/plugins/notices/prepared-messages/?status=ready\n</code></pre></p> </li> <li> <p>For each message, the delivery system:</p> </li> <li>Extracts recipient emails from <code>recipients</code> array</li> <li>Sends the message via appropriate channel (email, Slack, etc.)</li> <li>Updates status to <code>sent</code></li> <li>Updates status to <code>delivered</code> or <code>failed</code> based on result</li> </ol>"},{"location":"outgoing-notifications/#webhook-integration","title":"Webhook Integration","text":"<p>For push-based delivery, use NetBox's built-in Event Rules:</p> <ol> <li>Go to Operations &gt; Event Rules</li> <li>Create a rule for <code>PreparedMessage</code> object type</li> <li>Set condition: status = \"ready\"</li> <li>Configure webhook URL for your delivery system</li> </ol> <p>When a PreparedMessage transitions to <code>ready</code> status, NetBox will POST the message data to your webhook endpoint.</p>"},{"location":"outgoing-notifications/#example-delivery-script","title":"Example Delivery Script","text":"<pre><code>#!/usr/bin/env python3\n\"\"\"Example script to deliver prepared messages via SMTP.\"\"\"\n\nimport requests\nimport smtplib\nfrom datetime import datetime, timezone\nfrom email.message import EmailMessage\n\nNETBOX_URL = \"https://netbox.example.com\"\nAPI_TOKEN = \"your-api-token\"\nSMTP_HOST = \"smtp.example.com\"\n\nheaders = {\"Authorization\": f\"Token {API_TOKEN}\"}\n\n# Fetch ready messages\nresponse = requests.get(\n    f\"{NETBOX_URL}/api/plugins/notices/prepared-messages/\",\n    params={\"status\": \"ready\"},\n    headers=headers,\n)\nmessages = response.json()[\"results\"]\n\nfor msg in messages:\n    try:\n        # Build email\n        email = EmailMessage()\n        email[\"Subject\"] = msg[\"subject\"]\n        email[\"From\"] = \"noc@example.com\"\n        email[\"To\"] = \", \".join(r[\"email\"] for r in msg[\"recipients\"])\n        email.set_content(msg[\"body_text\"])\n\n        if msg[\"body_html\"]:\n            email.add_alternative(msg[\"body_html\"], subtype=\"html\")\n\n        if msg[\"ical_content\"]:\n            email.add_attachment(\n                msg[\"ical_content\"].encode(),\n                maintype=\"text\",\n                subtype=\"calendar\",\n                filename=\"maintenance.ics\",\n            )\n\n        # Record send time before sending\n        sent_at = datetime.now(timezone.utc).isoformat()\n\n        # Send email\n        with smtplib.SMTP(SMTP_HOST) as smtp:\n            smtp.send_message(email)\n\n        # Update status to sent with timestamp\n        requests.patch(\n            f\"{NETBOX_URL}/api/plugins/notices/prepared-messages/{msg['id']}/\",\n            json={\"status\": \"sent\", \"timestamp\": sent_at, \"message\": \"Sent via SMTP\"},\n            headers=headers,\n        )\n\n        # Update status to delivered\n        delivered_at = datetime.now(timezone.utc).isoformat()\n        requests.patch(\n            f\"{NETBOX_URL}/api/plugins/notices/prepared-messages/{msg['id']}/\",\n            json={\n                \"status\": \"delivered\",\n                \"timestamp\": delivered_at,\n                \"message\": f\"Delivered to {len(msg['recipients'])} recipients\",\n            },\n            headers=headers,\n        )\n\n    except Exception as e:\n        # Mark as failed\n        requests.patch(\n            f\"{NETBOX_URL}/api/plugins/notices/prepared-messages/{msg['id']}/\",\n            json={\"status\": \"failed\", \"message\": str(e)},\n            headers=headers,\n        )\n</code></pre>"},{"location":"outgoing-notifications/#slack-integration-example","title":"Slack Integration Example","text":"<pre><code>\"\"\"Example: Post prepared messages to Slack.\"\"\"\n\nimport requests\n\nNETBOX_URL = \"https://netbox.example.com\"\nAPI_TOKEN = \"your-netbox-token\"\nSLACK_WEBHOOK = \"https://hooks.slack.com/services/...\"\n\nheaders = {\"Authorization\": f\"Token {API_TOKEN}\"}\n\nresponse = requests.get(\n    f\"{NETBOX_URL}/api/plugins/notices/prepared-messages/\",\n    params={\"status\": \"ready\"},\n    headers=headers,\n)\n\nfor msg in response.json()[\"results\"]:\n    # Post to Slack\n    slack_payload = {\n        \"text\": msg[\"subject\"],\n        \"blocks\": [\n            {\"type\": \"header\", \"text\": {\"type\": \"plain_text\", \"text\": msg[\"subject\"]}},\n            {\"type\": \"section\", \"text\": {\"type\": \"mrkdwn\", \"text\": msg[\"body_text\"][:3000]}},\n        ],\n    }\n\n    result = requests.post(SLACK_WEBHOOK, json=slack_payload)\n\n    if result.ok:\n        requests.patch(\n            f\"{NETBOX_URL}/api/plugins/notices/prepared-messages/{msg['id']}/\",\n            json={\"status\": \"delivered\", \"message\": \"Posted to Slack\"},\n            headers=headers,\n        )\n</code></pre>"},{"location":"outgoing-notifications/#aws-ses-integration","title":"AWS SES Integration","text":"<p>For a complete, deployable AWS SES integration that handles outbound delivery with full delivery lifecycle tracking (delivery confirmation, bounce/complaint handling, open/click tracking), see the AWS SES Integration guide.</p> <p>The SES integration provides:</p> <ul> <li>Scheduled polling for ready notifications</li> <li>MIME email construction with HTML, plain text, and iCal attachments</li> <li>SES Configuration Set with SNS event destinations for tracking</li> <li>Automatic status updates (sent, delivered, failed) based on SES events</li> <li>Journal entries for informational events (open, click, delivery delay)</li> </ul>"},{"location":"parsers/","title":"Using a parser","text":"<p>Parsers are designed to take the incoming email notifications from carriers and parse them in to a machine readable JSON format which can then be passed to the circuit maintenance plugin API for storage and further processing. The challenge is that virtually every provider leverages their own maintenance notification format with very little uptake of industry standards, the circuit-maintenance-parser python package was written to convert both standard based iCal notifications and non-standard HTML based notifications in to a well defined structure.</p> <p>The high level process is simple, a parser leverages the  circuit-maintenance-parser library to parse inbound notifications, passing them to the NetBox Circuit Maintenance plugin, the plugin then stores and optionally post-processes the notification (i.e. duplication detection, consolidated notifications).</p> <p>The following parsers have been written and/or contributed by the community to assist in automating provider maintenance notifications:</p> <ul> <li>AWS SNS &amp; Lambda</li> <li> <p>AWS SES Integration \u2014 Full SES integration with inbound parsing, outbound delivery, and delivery tracking via SAM</p> </li> <li> <p>IMAP Netbox Script (Coming Soon)</p> </li> <li> <p>IMAP CRON Job (Coming Soon)</p> </li> </ul>"},{"location":"parsers_sns_lambda/","title":"AWS SNS & Lambda","text":"<p>This parser leverages a server-less design for near-realtime processing of provider notifications via AWS Simple Email Service, S3 &amp; Lambda to receive, parse and push maintenance events to NetBox. </p> <p>Pricing for the deployment will vary based on the volume of emails processed per month however in testing it is feasible to operate this solution for under $1/mo with less than 1000 emails/mo.</p>"},{"location":"parsers_sns_lambda/#requirements","title":"Requirements","text":"<p>Amazon AWS Simple Email Service Amazon AWS Lambda Amazon AWS S3 Connectivity from your VPC hosting the Lambda function to Netbox.</p> <p>Note: The basic setup of verifying your domain and publishing MX records to allow SES to receive email on behalf of your domain is not covered in this guide, please see Setting up Amazon SES email receiving.</p> <p>Note: Your Lambda function either needs to be in the same VPC as Netbox, have connectivity to Netbox over the internet, or have private connectivity to Netbox via Direct Connect etc.</p> <p>Note: You will need to inform any relevant circuit providers to send maintenance notifications to the email address you configure to be processed by SES. This guide does not cover that process.</p>"},{"location":"parsers_sns_lambda/#flow-diagram","title":"Flow Diagram","text":"<ol> <li>Provider sends email notification to email address configured for receiving email in AWS SES</li> <li>SES stores the raw email as S3 object</li> <li>SES triggers Lambda function and passes email headers</li> <li>Lambda function retrieves raw email from S3, performs validation of the provider and parses it using circuit_maintenance_parser</li> <li>Maintenance event is passed to NetBox for storage and further processing </li> </ol>"},{"location":"parsers_sns_lambda/#aws-setup","title":"AWS Setup","text":"<p>The following steps will guide you through creating a Lambda function, giving it permission to read from an S3 bucket along with VPC access (if required), creating the SES rules to pass emails to Lambda and the creation of an S3 bucket to store incoming email.</p> <p>Step 1 - Navigate to Lambda -&gt; Create Function to create a new Lambda function to host the email parser. 1. Enter a name for the Lambda function &amp; select Python 3.9 as the runtime.  2. Under Advanced Settings, enable VPC access. (If required) 3. Select the VPC, 2 or more relevant subnets from your VPC and an appropriate security group. 4. Click Create function 5. Once created, navigate to Configuration -&gt; Permissions to find the IAM role that was automatically created. Click the role name to launch the IAM tool. 6. Navigate to Add Permissions -&gt; Attach Policies and select AmazonS3ReadOnlyAccess and click Attach Policy </p> <p>Step 2 - Navigate to Simple Email Service -&gt; Email receiving and create a rule set.</p> <p></p> <ol> <li>Within the rule set you just created, create a new rule.</li> <li>Enter a name for the rule, ensure it is Enabled. Leave security options as default.</li> <li>Add new recipient condition - enter the email address you wish to use to receive email. You must have previously verified your domain with SES and setup MX records.</li> <li>Add new action -&gt; Deliver to S3 bucket. You can specify an existing bucket or have SES create a new one for you.</li> <li>Add new action -&gt; Invoke AWS Lambda function. Select the Lambda function you created in Step 1. Ensure invocation type is set to Event Invocation which will trigger the Lambda function as each email is received. </li> <li>Click Next followed by Create Rule. Allow AWS to create the relevant IAM permissions for SES to access the Lambda function.</li> </ol> <p>Step 3 - Update S3 bucket to disable public access (if required)</p> <p>If you allowed SES to create the S3 bucket automatically, it creates the bucket with public access enabled, this is not recommended or required for this deployment and should be disabled.</p> <ol> <li>Navigate to S3 -&gt; Select your bucket that was created.</li> <li>Click Permissions and under Block Public Access select Edit. </li> <li>Select Block all public access &amp; Save Changes </li> </ol>"},{"location":"parsers_sns_lambda/#lambda-deployment","title":"Lambda Deployment","text":"<p>Due to how Lambda operates in an ephemeral environment, there is no means to install packages from pip on each invocation of the Lambda function, as a result you have to build the Lambda function locally and create a zip file containing the function and all required python modules. The following steps will guide you through configuring the python script for your environment, building the package and uploading it to the Lambda function.</p> <p>If you haven't already, use git to checkout a copy of the netbox-circuitmaintenance git repository. </p> <p>Step 1 - Configure variables</p> <ol> <li>Navigate to <code>parsers/aws-sns-lambda/</code></li> <li>Edit lambda_function.py and configure the following variables as relevant for your environment <pre><code>S3_BUCKET_NAME  =  'your-s3-bucket'\nNB_URL  =  'https://netbox.yourdomain.com'\nNB_API_TOKEN  =  'yournetboxtokenhere'\nS3_DELETE_UNKNOWN  =  False # Delete non-provider matched emails from the S3 bucket\nS3_DELETE_PROCESSED  =  False # Delete provder matched emails from the S3 bucket after processing\n</code></pre></li> </ol> <p>Step 2 - Build lambda deployment package</p> <p>A bash script is included with the python code that creates a local virtual environment, collects the required python modules and creates a .zip file that can be uploaded to Lambda. To execute the bash script do the following</p> <ol> <li><code>chmod +x create_pkg.sh</code> </li> <li><code>./create_pkg.sh</code></li> </ol> <p>Example: <pre><code>Executing create_pkg.sh...\ncreated virtual environment CPython3.9.6.final.0-64 in 762ms\nInstalling dependencies...\nFrom: requirements.txt file exists...\n......\nRemoving virtual environment folder...\nFinished script execution!\n</code></pre></p> <p>After execution has finished, you will be left with a zip archive <code>lambda_package.zip</code> that can be uploaded to your AWS Lambda function.</p> <p>Step 3 - Upload the package to Lambda</p> <ol> <li>Navigate to Lambda -&gt; Your function - &gt; Code</li> <li>Under Upload From select .zip </li> <li>Upload the zip archive created</li> </ol>"},{"location":"parsers_sns_lambda/#troubleshooting","title":"Troubleshooting","text":"<p>Email's are not received by SES This guide does not cover the setup of SES and creation of MX records etc. Please refer to AWS troubleshooting guides for SES. If SES is setup correctly, each email sent to SES will create a new S3 object.</p> <p>Lambda is not processing emails received by SES If you are correctly receiving email and SES is storing them in S3, review the CloudWatch logs for your Lambda function to confirm that Lambda is correctly invoking your function each time an email is received. The cloudwatch logs will show any errors generated by the python script.</p> <p>Timeout in connection to Netbox Validate your Lambda function has connectivity to Netbox, if Netbox is hosted in AWS or within your network, the function must have VPC permissions enabled and must have network connectivity to Netbox. </p> <p>Building from an M1 Mac If you are using an M1 Mac to build the Lambda package, some dependencies compile a binary which will not work on an x86 based Lambda function. Either build the package on an x86 based machine or re-create the Lambda function and choose arm as the environment type.</p>"}]}